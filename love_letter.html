<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gửi đến em</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&family=Inter:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --pink: #ffdde1; /* pastel pink */
        --blue: #ee9ca7; /* soft light blue/pink gradient tone as requested */
        --ink: #2b2b2b;
        --muted: #666;
        --card-bg: rgba(255, 255, 255, 0.55);
        --glass: blur(10px) saturate(120%);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial,
          sans-serif;
        color: var(--ink);
        background: radial-gradient(
            1200px 800px at 10% 10%,
            var(--blue),
            transparent 60%
          ),
          radial-gradient(1200px 800px at 90% 20%, var(--pink), transparent 60%),
          linear-gradient(120deg, var(--pink), var(--blue));
        overflow-x: hidden;
        position: relative;
        transition: background 800ms ease;
      }

      /* Canvas background */
      #bg {
        position: fixed;
        inset: 0;
        z-index: -1;
        display: block;
        width: 100%;
        height: 100%;
      }

      .container {
        min-height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 72px 16px 120px;
        gap: 28px;
      }

      h1.title {
        font-family: "Dancing Script", cursive;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-align: center;
        margin: 0;
        color: #973a54;
        font-size: clamp(28px, 6vw, 54px);
        text-shadow: 0 2px 18px rgba(255, 255, 255, 0.55);
      }

      .typewriter {
        font-size: clamp(16px, 4.6vw, 22px);
        color: var(--muted);
        min-height: 1.6em;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        border-right: 2px solid rgba(0, 0, 0, 0.2);
        align-self: center;
      }

      .hero {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 22px;
      }

      .avatar-wrap {
        position: relative;
        width: 180px;
        height: 180px;
        border-radius: 50%;
        padding: 6px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.8),
          rgba(255, 255, 255, 0.15)
        );
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        animation: pulse 2.2s ease-in-out infinite;
        backdrop-filter: var(--glass);
      }
      .avatar {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        display: block;
        background: linear-gradient(135deg, #ffd6dd, #f2f7ff);
      }
      .avatar::after {
        content: "";
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
        100% {
          transform: scale(1);
        }
      }

      .cta {
        appearance: none;
        border: none;
        cursor: pointer;
        padding: 14px 22px;
        border-radius: 14px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.75),
          rgba(255, 255, 255, 0.35)
        );
        color: #7a2640;
        font-weight: 600;
        letter-spacing: 0.2px;
        box-shadow: 0 10px 26px rgba(154, 74, 102, 0.25);
        backdrop-filter: var(--glass);
        transition: transform 0.15s ease, box-shadow 0.3s ease,
          background 0.3s ease;
      }
      .cta:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 34px rgba(154, 74, 102, 0.28);
      }
      .cta:active {
        transform: translateY(1px) scale(0.99);
      }

      .letter {
        max-width: 780px;
        width: 100%;
        background: var(--card-bg);
        border-radius: 18px;
        padding: 20px 18px;
        line-height: 1.75;
        font-size: clamp(15px, 3.6vw, 18px);
        color: #3b2b2f;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        opacity: 0;
        transform: translateY(12px);
        transition: opacity 0.6s ease, transform 0.6s ease;
        backdrop-filter: var(--glass);
      }
      .letter.show {
        opacity: 1;
        transform: translateY(0);
      }

      .audio-toggle {
        position: fixed;
        bottom: 18px;
        right: 18px;
        z-index: 2;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.75);
        color: #7a2640;
        display: grid;
        place-items: center;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
        backdrop-filter: var(--glass);
      }

      footer {
        margin-top: 12px;
        color: #875866;
        font-size: 12px;
        opacity: 0.8;
        text-align: center;
      }

      /* Responsive refinement */
      @media (max-width: 480px) {
        .avatar-wrap {
          width: 150px;
          height: 150px;
        }
        .container {
          padding-top: 56px;
          padding-bottom: 100px;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="bg"></canvas>

    <div class="container">
      <div class="hero">
        <h1 class="title">Dành tặng em</h1>
        <div
          id="typing"
          class="typewriter"
          aria-live="polite"
          aria-label="Typewriter"
        ></div>
        <div class="avatar-wrap" aria-label="Ảnh của em (placeholder)">
          <!-- Replace src with your own photo URL -->
          <img
            class="avatar"
            alt="Ảnh của em"
            src="https://scontent.fsgn2-6.fna.fbcdn.net/v/t39.30808-1/593298132_2394915367632633_5477640251273240342_n.jpg?stp=dst-jpg_s200x200_tt6&_nc_cat=111&ccb=1-7&_nc_sid=e99d92&_nc_ohc=t4iUy91boG8Q7kNvwHb0XiQ&_nc_oc=AdkcV4n8s_Mwl2jRw5K9EHb9NK0VS6k9lEH5vQ_Eks9hXX1Sy5a3NZupz34VNZkUA84&_nc_zt=24&_nc_ht=scontent.fsgn2-6.fna&_nc_gid=waDKgDn-H_bVeCB1TDkghw&oh=00_AfljUM81lCSLK94vRwxVv5NuXrFPESfWZvLo5R2l2G10_g&oe=6948B63A"
          />
        </div>
        <button id="revealBtn" class="cta">Nhấn vào đây đi em</button>
      </div>

      <article id="letter" class="letter" aria-hidden="true">
        <p>Em yêu,</p>
        <p>
          Có lẽ anh không giỏi nói những lời hoa mỹ, nhưng mỗi ngày ở bên em đều
          khiến trái tim anh dịu lại. Em là bình minh dịu nhẹ, là cơn gió mát
          sau ngày dài, là lý do để anh mỉm cười giữa bộn bề.
        </p>
        <p>
          Cảm ơn em vì đã đến, vì đã dịu dàng và kiên nhẫn. Dẫu mai này mọi thứ
          có đổi thay, mong rằng em vẫn luôn hạnh phúc, còn anh – vẫn sẽ ở đây,
          thương em và dõi theo em, thật khẽ.
        </p>
        <p>Yêu em.</p>
      </article>

      <footer>Made with ♥</footer>
    </div>

    <!-- Hidden audio (autoplay if allowed) -->
    <audio id="bgm" preload="auto" loop>
      <source src="Nghe Như Tình Yêu.mp3" type="audio/mpeg" />
    </audio>
    <button
      id="audioToggle"
      class="audio-toggle"
      title="Bật/tắt nhạc"
      aria-label="Bật tắt nhạc"
    >
      ♪
    </button>

    <script>
      // Utility: prefers-reduced-motion
      const prefersReducedMotion = window.matchMedia(
        "(prefers-reduced-motion: reduce)"
      ).matches;

      // 1) Canvas particles/hearts
      (function () {
        const canvas = document.getElementById("bg");
        const ctx = canvas.getContext("2d");
        let w, h, dpr;
        const particles = [];
        const HEART = 0,
          GLOW = 1;
        let mouse = { x: null, y: null };

        function resize() {
          dpr = Math.min(window.devicePixelRatio || 1, 2);
          w = canvas.width = Math.floor(window.innerWidth * dpr);
          h = canvas.height = Math.floor(window.innerHeight * dpr);
          canvas.style.width = "100%";
          canvas.style.height = "100%";
        }
        window.addEventListener("resize", resize);
        resize();

        function rand(a, b) {
          return a + Math.random() * (b - a);
        }

        function spawnParticle(follow = false) {
          const type = Math.random() < 0.55 ? HEART : GLOW;
          const size = type === HEART ? rand(6, 12) : rand(2, 4);
          const px =
            follow && mouse.x != null
              ? mouse.x * dpr + rand(-20, 20)
              : rand(0, w);
          const py =
            follow && mouse.y != null
              ? mouse.y * dpr + rand(-20, 20)
              : rand(0, h);
          particles.push({
            x: px,
            y: py,
            vx: rand(-0.3, 0.3),
            vy: rand(-0.6, -0.2),
            life: rand(2.5, 5),
            age: 0,
            size,
            type,
            drift: rand(-0.05, 0.05),
            rot: rand(0, Math.PI * 2),
            spin: rand(-0.02, 0.02),
          });
        }

        // Pre-seed
        let baseCount = Math.min(120, Math.floor(window.innerWidth / 8));
        for (let i = 0; i < baseCount; i++) spawnParticle(false);

        canvas.addEventListener("mousemove", (e) => {
          const rect = canvas.getBoundingClientRect();
          mouse.x = e.clientX - rect.left;
          mouse.y = e.clientY - rect.top;
          if (!prefersReducedMotion) {
            for (let i = 0; i < 3; i++) spawnParticle(true);
          }
        });
        canvas.addEventListener("mouseleave", () => {
          mouse.x = mouse.y = null;
        });

        function drawHeart(x, y, s, rot, alpha) {
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate(rot);
          ctx.scale(s / 12, s / 12);
          ctx.beginPath();
          // Heart shape path
          ctx.moveTo(0, 6);
          ctx.bezierCurveTo(0, 3, -6, 0, -6, -3);
          ctx.bezierCurveTo(-6, -6.5, -2.5, -8, 0, -5);
          ctx.bezierCurveTo(2.5, -8, 6, -6.5, 6, -3);
          ctx.bezierCurveTo(6, 0, 0, 3, 0, 6);
          ctx.closePath();
          ctx.fillStyle = `rgba(238,156,167,${alpha})`;
          ctx.shadowColor = "rgba(238,156,167,0.6)";
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.restore();
        }

        function drawGlow(x, y, r, alpha) {
          const g = ctx.createRadialGradient(x, y, 0, x, y, r);
          g.addColorStop(0, `rgba(255,221,225,${alpha})`);
          g.addColorStop(1, "rgba(255,221,225,0)");
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.fill();
        }

        let last = performance.now();
        function tick(now) {
          const dt = Math.min(0.033, (now - last) / 1000);
          last = now;
          ctx.clearRect(0, 0, w, h);

          // spawn gentle new ones
          if (particles.length < baseCount) {
            spawnParticle(false);
          }

          for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.age += dt;
            if (p.age > p.life) {
              particles.splice(i, 1);
              continue;
            }
            const t = p.age / p.life;
            p.vx += p.drift * dt * 30;
            p.vy += 0.05; // gravity-like gentle fall
            p.x += p.vx * 8;
            p.y += p.vy * 8;
            p.rot += p.spin;
            const alpha = Math.sin((1 - t) * Math.PI) * 0.9;
            if (p.type === 0) drawHeart(p.x, p.y, p.size * dpr, p.rot, alpha);
            else drawGlow(p.x, p.y, p.size * dpr * 2.5, alpha * 0.9);
          }
          requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      })();

      // 2) Typewriter effect
      (function () {
        const el = document.getElementById("typing");
        const text = "Gửi ��ến người con gái anh yêu nhất...";
        let i = 0;
        function type() {
          if (i <= text.length) {
            el.textContent = text.slice(0, i);
            i++;
            setTimeout(type, 70);
          } else {
            // Blink caret effect
            el.style.borderRightColor = "transparent";
          }
        }
        setTimeout(type, 500);
      })();

      // 3) Reveal letter + background shift + confetti
      (function () {
        const btn = document.getElementById("revealBtn");
        const letter = document.getElementById("letter");
        let toggled = false;

        function shiftBackground() {
          document.body.style.background = toggled
            ? "linear-gradient(120deg, var(--pink), var(--blue))"
            : "linear-gradient(120deg, #ffd4da, #f3b3c1)";
        }

        // Minimal confetti without external libs
        function confettiBurst() {
          const N = 120;
          const { innerWidth: W, innerHeight: H } = window;
          const canvas = document.createElement("canvas");
          canvas.width = W;
          canvas.height = H;
          canvas.style.cssText =
            "position:fixed;inset:0;pointer-events:none;z-index:3;";
          document.body.appendChild(canvas);
          const c = canvas.getContext("2d");
          const pieces = Array.from({ length: N }).map(() => ({
            x: Math.random() * W,
            y: -20 - Math.random() * H * 0.3,
            r: 4 + Math.random() * 5,
            vx: -2 + Math.random() * 4,
            vy: 2 + Math.random() * 3,
            rot: Math.random() * Math.PI * 2,
            vr: -0.2 + Math.random() * 0.4,
            color: `hsl(${Math.floor(Math.random() * 50) + 330} 80% 70%)`,
          }));
          let t0 = performance.now();
          function loop(t) {
            const dt = Math.min(0.033, (t - t0) / 1000);
            t0 = t;
            c.clearRect(0, 0, W, H);
            pieces.forEach((p) => {
              p.x += p.vx;
              p.y += p.vy;
              p.vy += 0.03;
              p.rot += p.vr;
              c.save();
              c.translate(p.x, p.y);
              c.rotate(p.rot);
              c.fillStyle = p.color;
              c.fillRect(-p.r, -p.r * 0.4, p.r * 2, p.r * 0.8);
              c.restore();
            });
            if (t - start < 2200) requestAnimationFrame(loop);
            else canvas.remove();
          }
          const start = performance.now();
          requestAnimationFrame(loop);
        }

        btn.addEventListener("click", () => {
          toggled = !toggled;
          shiftBackground();
          letter.classList.add("show");
          letter.setAttribute("aria-hidden", "false");
          confettiBurst();
        });
      })();

      // 4) Audio autoplay / toggle
      (function () {
        const audio = document.getElementById("bgm");
        const btn = document.getElementById("audioToggle");
        let playing = false;

        function updateBtn() {
          btn.style.opacity = playing ? 1 : 0.85;
          btn.textContent = playing ? "❚❚" : "♪";
        }

        async function tryAutoplay() {
          try {
            await audio.play();
            playing = true;
            updateBtn();
          } catch (e) {
            /* Autoplay blocked; wait for user gesture */
          }
        }
        tryAutoplay();

        btn.addEventListener("click", async () => {
          if (!playing) {
            try {
              await audio.play();
              playing = true;
            } catch (e) {
              /* ignore */
            }
          } else {
            audio.pause();
            playing = false;
          }
          updateBtn();
        });
      })();
    </script>
  </body>
</html>
